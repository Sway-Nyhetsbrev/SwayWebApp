<section id="createNewsletterSection">
  <div class="container">
    <h2>Create Newsletter</h2>
    <form (ngSubmit)="saveNewsletter()" [ngClass]="newsletter()?.theme?.className">
      <div id="newsletter-content">
        <div class="form-group-content">
          <div class="form-group">
            <label for="Title" class="form-label">Title:</label>
            <input type="text" [class]="validationClass" placeholder="Title" name="title" required [(ngModel)]="newsletter()!.title" />
          </div>

          <div class="form-group" id="releaseDate">
            <label for="Release date" class="form-label">Release date:</label>
            <input [class]="validationClass" type="date" name="releaseDate" [(ngModel)]="newsletter()!.releaseDate"/>
          </div>

          <div class="form-group" id="theme">
            <label for="theme" class="form-label">Theme:</label>
            <select
              class="form-control"
              [(ngModel)]="selectedTheme"
              name="theme"
              (ngModelChange)="selectTheme($event)">

              <option value="default-theme">Default</option>
              <option value="light-theme">Light</option>
              <option value="blue-to-pink">Blue to Pink</option>
              <option value="purple-to-blue">Purple to Blue</option>
              <option value="red-to-orange">Red to Orange</option>
              <option value="green-to-blue">Green to Blue</option>
              <option value="yellow-to-red">Yellow to Red</option>
              <option value="blue-to-turquoise">Blue to Turquoise</option>
              <option value="pink-to-purple">Pink to Purple</option>
              <option value="orange-to-yellow">Orange to Yellow</option>
              <option value="blue-to-green">Blue to Green</option>
              <option value="dark-purple-to-red">Dark Purple to Red</option>
            </select>
          </div>
        </div>

        <div class="sectionContent">
          @if(newsletter()!.sections.length > 0) { 
            @for(section of newsletter()!.sections; track section) {
              @if(editingSection === section) {
                <!-- Inline-redigering: visa editor istället för innehåll -->
                <app-create-newsletter-section [section]="editingSection" (save)="saveSection($event)"></app-create-newsletter-section>
                <button type="button" class="btn btn-warning" (click)="cancelEdit()">Cancel Edit</button>
              }

              @else {
                <!-- Visa sektionens innehåll -->
                <div [innerHTML]="sanitizer.bypassSecurityTrustHtml(section.content)">
                </div>
                <div class="buttonContent">
                  <button type="button" class="btn btn-warning" (click)="editSection(section)">
                    Edit Section
                  </button>
                  <button type="button" class="btn btn-danger" (click)="removeSection(section)">
                    Remove Section
                  </button>
                </div>
              }
            }
          }

          @if(!editingSection && !showNewSection) {
            <button type="button" class="btn btn-primary" (click)="openNewSection()">
              Add Section
            </button>
          }

          @if(showNewSection) {
            <!-- Editor för en ny sektion -->
            <app-create-newsletter-section [section]="newSection" (save)="saveSection($event)"></app-create-newsletter-section>
            <div id="closeSectionBtn">
              <button  type="button" class="btn btn-warning" (click)="cancelNewSection()">Close Section</button>
            </div>
          }

          <button class="btn btn-success" type="submit">
            Save Newsletter
          </button>
          @if(statusMessage) {
            <div [class]="statusClass" role="alert">
              {{ statusMessage }}
            </div>
          }
        </div>
      </div>
    </form>
  </div>
</section>
